<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta name="format-detection" content="telephone=no"/>
	<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi"/>
	<title>Tracker</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css"/>
	<script src="js/jquery-2.1.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</head>
<body>
	<div class="panel panel-default">
		<div class="panel-heading">Geolocation</div>
		<div class="panel-body">
			<pre id="geolocation">-</pre>
		</div>
	</div>
	<div class="panel panel-default">
		<div class="panel-heading">Compass</div>
		<div class="panel-body">
			<pre id="compass">-</pre>
		</div>
	</div>
	<div class="panel panel-default">
		<div class="panel-heading">Accelerometer</div>
		<div class="panel-body">
			<pre id="accelerometer">-</pre>
		</div>
	</div>
	<div class="panel panel-default">
		<div class="panel-heading">Position</div>
		<div class="panel-body">
			<pre id="position">-</pre>
		</div>
	</div>
	<script src="phonegap.js"></script>
	<script>
document.addEventListener('deviceready', function () {
	var geolocationDisplay = $('#geolocation');
	var compassDisplay = $('#compass');
	var accelerometerDisplay = $('#accelerometer');
	var positionDisplay = $('#position');

	navigator.geolocation.watchPosition(function (position) {
		geolocationDisplay.text(JSON.stringify(position));
	}, function (error) {
		geolocationDisplay.text('error: ' + JSON.stringify(error));
	}, {
		timeout: 1000
	});

	navigator.compass.watchHeading(function (heading) {
		compassDisplay.text('' + heading.magneticHeading);
	}, function (error) {
		compassDisplay.text('error: ' + JSON.stringify(error));
	}, {
		frequency: 100
	});

	var velocity, position;

	function reset() {
		velocity = {
			x: 0,
			y: 0,
			z: 0
		};
		position = {
			x: 0,
			y: 0,
			z: 0
		};
	}

	reset();

	navigator.accelerometer.watchAcceleration(function (acceleration) {
		var h = Math.sqrt(
			acceleration.x * acceleration.x + 
			acceleration.y * acceleration.y + 
			acceleration.z * acceleration.z
			) - 9.81;
		acceleration.x *= h;
		acceleration.y *= h;
		acceleration.z *= h;
		velocity.x += acceleration.x;
		velocity.y += acceleration.y;
		velocity.z += acceleration.z;
		position.x += velocity.x;
		position.y += velocity.y;
		position.z += velocity.z;
		accelerometerDisplay.text('x: ' + acceleration.x + '\ny: ' + acceleration.y + '\nz: ' + acceleration.z);
		positionDisplay.text('x: ' + position.x + '\ny: ' + position.y + '\nz: ' + position.z);
	}, function (error) {
		reset();
		accelerometerDisplay.text('error: ' + JSON.stringify(error));
		positionDisplay.text('error');
	}, {
		frequency: 1000
	});
}, false);
	</script>
</body>
</html>
